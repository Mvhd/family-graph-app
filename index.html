<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Family Graph App</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      margin: 0; padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
    .container {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      max-width: 600px;
      width: 90%;
      text-align: center;
    }
    h1 {
      margin-bottom: 1rem;
    }
    .question {
      font-size: 1.2rem;
      margin-bottom: 1rem;
    }
    .slider-value {
      font-weight: bold;
      margin: 0.5rem 0 1rem 0;
    }
    label {
      font-weight: 600;
      display: block;
      margin-top: 10px;
    }
    input[type=range] {
      width: 100%;
      margin-top: 4px;
    }
    button {
      background-color: #4CAF50;
      color: white;
      padding: 0.6rem 1.2rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
      margin: 0.5rem;
    }
    button:disabled {
      background-color: #aaa;
      cursor: not-allowed;
    }
    canvas {
      margin-top: 2rem;
    }
    #analysis {
      margin-top: 1.5rem;
      font-size: 1rem;
      color: #444;
      background: #eef9f1;
      padding: 1rem;
      border-radius: 8px;
      min-height: 120px;
    }
    #shareBtn, #navBtns {
      display: none;
      margin-top: 1rem;
    }
    #navBtns button {
      background-color: #777;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Relationship / Family Graph App</h1>
    <div class="question" id="question">Q1: How many times do you have sex per week in a month?</div>

    <!-- Multi sliders for Q1 -->
    <div id="multiSliders" style="display:none; margin-bottom:1rem;">
      <label>Sexual Intimacy: <span id="intimacyVal">15</span>/30</label>
      <input type="range" id="intimacySlider" min="0" max="30" value="15" />

      <label>Communication: <span id="communicationVal">15</span>/30</label>
      <input type="range" id="communicationSlider" min="0" max="30" value="15" />

      <label>Trust: <span id="trustVal">15</span>/30</label>
      <input type="range" id="trustSlider" min="0" max="30" value="15" />

      <label>Fun Together: <span id="funVal">15</span>/30</label>
      <input type="range" id="funSlider" min="0" max="30" value="15" />
    </div>

    <!-- Single slider for other questions -->
    <div id="singleSliderContainer">
      <input type="range" id="answerSlider" min="0" max="10" value="5" />
      <div class="slider-value" id="sliderValue">5</div>
    </div>

    <div>
      <button onclick="submitAnswer()">Submit</button>
      <div id="navBtns">
        <button id="prevBtn" onclick="prevQuestion()">Previous Question</button>
        <button id="nextBtn" onclick="nextQuestion()">Next Question</button>
      </div>
      <button id="shareBtn" onclick="shareGraph()">Share Graph</button>
    </div>

    <canvas id="resultChart" width="400" height="300"></canvas>
    <div id="analysis"></div>
  </div>

<script>
  const questions = [
    "How many times do you have sex per week in a month?",
    "How often do you talk deeply about emotions and plans?",
    "How many days in a month do you spend quality time without distractions?",
    "How often do you feel emotionally connected with your partner?",
    "How many conflicts are resolved calmly in a month?"
  ];

  let currentQuestionIndex = 0;

  const questionBox = document.getElementById('question');
  const analysisBox = document.getElementById('analysis');
  const shareBtn = document.getElementById('shareBtn');
  const navBtns = document.getElementById('navBtns');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');

  // Multi sliders & labels for Q1
  const multiSlidersDiv = document.getElementById('multiSliders');
  const intimacySlider = document.getElementById('intimacySlider');
  const communicationSlider = document.getElementById('communicationSlider');
  const trustSlider = document.getElementById('trustSlider');
  const funSlider = document.getElementById('funSlider');

  const intimacyVal = document.getElementById('intimacyVal');
  const communicationVal = document.getElementById('communicationVal');
  const trustVal = document.getElementById('trustVal');
  const funVal = document.getElementById('funVal');

  // Single slider & label
  const singleSliderContainer = document.getElementById('singleSliderContainer');
  const slider = document.getElementById('answerSlider');
  const sliderValue = document.getElementById('sliderValue');

  // Update multi slider labels on input
  [intimacySlider, communicationSlider, trustSlider, funSlider].forEach((sliderElem) => {
    sliderElem.oninput = () => {
      intimacyVal.textContent = intimacySlider.value;
      communicationVal.textContent = communicationSlider.value;
      trustVal.textContent = trustSlider.value;
      funVal.textContent = funSlider.value;
    };
  });

  // Update single slider label
  slider.oninput = () => {
    sliderValue.textContent = slider.value;
  };

  // Generate values for other questions from single slider (0-10 scaled)
  function generateData(value) {
    const base = value * 3;
    return [
      Math.min(30, base),         // Sexual Intimacy
      Math.min(30, value * 2),    // Communication
      Math.min(30, value * 2.5),  // Trust
      Math.min(30, value * 2.2)   // Fun Together
    ];
  }

  // Analysis logic based on scores
  function getAnalysis(data) {
    const [sex, communication, trust, fun] = data;
    const avg = (sex + communication + trust + fun) / 4;
    let summary = `<strong>Relationship Metrics:</strong><br>`;
    summary += `Sexual Intimacy: ${sex}/30<br>`;
    summary += `Communication: ${communication}/30<br>`;
    summary += `Trust: ${trust}/30<br>`;
    summary += `Fun Together: ${fun}/30<br><br>`;
    summary += `<strong>AI Insight:</strong> Average score is ${avg.toFixed(1)} out of 30.<br>`;

    if(avg >= 22){
      summary += "✅ Strong relationship. Keep nurturing it!";
    } else if(avg >= 15){
      summary += "⚠️ Decent relationship. There is room for improvement.";
    } else {
      summary += "❌ Relationship may need attention. Consider open communication.";
    }
    return summary;
  }

  // Submit button handler
  function submitAnswer() {
    let values;
    if(currentQuestionIndex === 0){
      // Use all 4 sliders on Q1
      values = [
        Number(intimacySlider.value),
        Number(communicationSlider.value),
        Number(trustSlider.value),
        Number(funSlider.value)
      ];
    } else {
      const val = parseInt(slider.value);
      values = generateData(val);
    }

    const ctx = document.getElementById('resultChart').getContext('2d');
    if(window.myChart) window.myChart.destroy();

    window.myChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Sexual Intimacy', 'Communication', 'Trust', 'Fun Together'],
        datasets: [{
          label: 'Monthly Relationship Metrics',
          data: values,
          backgroundColor: ['#4CAF50', '#2196F3', '#FFC107', '#9C27B0'],
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true,
            max: 30
          }
        }
      }
    });

    const analysis = getAnalysis(values);
    analysisBox.innerHTML = analysis;
    shareBtn.style.display = 'inline-block';
    navBtns.style.display = 'block';
    updateNavButtons();
  }

  // Update UI when question changes
  function updateQuestionUI() {
    questionBox.textContent = `Q${currentQuestionIndex + 1}: ${questions[currentQuestionIndex]}`;
    analysisBox.innerHTML = "";
    shareBtn.style.display = 'none';
    navBtns.style.display = 'none';
    if(window.myChart) window.myChart.destroy();

    if(currentQuestionIndex === 0){
      // Show multi sliders for Q1
      multiSlidersDiv.style.display = 'block';
      singleSliderContainer.style.display = 'none';

      intimacySlider.value = 15;
      communicationSlider.value = 15;
      trustSlider.value = 15;
      funSlider.value = 15;
      intimacyVal.textContent = 15;
      communicationVal.textContent = 15;
      trustVal.textContent = 15;
      funVal.textContent = 15;
    } else {
      // Show single slider for others
      multiSlidersDiv.style.display = 'none';
      singleSliderContainer.style.display = 'block';

      slider.value = 5;
      sliderValue.textContent = 5;
    }
    updateNavButtons();
  }

  // Navigation buttons logic
  function updateNavButtons(){
    prevBtn.disabled = currentQuestionIndex === 0;
    nextBtn.disabled = currentQuestionIndex === questions.length - 1;
  }
  function prevQuestion(){
    if(currentQuestionIndex > 0){
      currentQuestionIndex--;
      updateQuestionUI();
    }
  }
  function nextQuestion(){
    if(currentQuestionIndex < questions.length -1){
      currentQuestionIndex++;
      updateQuestionUI();
    }
  }

  // Share graph function (basic example: screenshot + share text)
  async function shareGraph(){
    try {
      const canvas = document.getElementById('resultChart');
      const imageUrl = canvas.toDataURL('image/png');
      const shareData = {
        title: 'Family Graph App',
        text: `Your relationship or family graph for question ${currentQuestionIndex + 1}: "${questions[currentQuestionIndex]}"`,
        files: [
          dataURLtoFile(imageUrl, 'graph.png')
        ]
      };

      if (navigator.canShare && navigator.canShare(shareData)) {
        await navigator.share(shareData);
      } else {
        alert('Sharing not supported. You can right-click the graph and save the image.');
      }
    } catch (err) {
      alert('Error sharing: ' + err);
    }
  }

  // Helper: Convert dataURL to File object for share API
  function dataURLtoFile(dataurl, filename) {
    const arr = dataurl.split(',');
    const mime = arr[0].match(/:(.*?);/)[1];
    const bstr = atob(arr[1]);
    let n = bstr.length;
    const u8arr = new Uint8Array(n);
    while(n--){
      u8arr[n] = bstr.charCodeAt(n);
    }
    return new File([u8arr], filename, {type:mime});
  }

  // Initialize UI on load
  updateQuestionUI();
</script>
</body>
</html>
